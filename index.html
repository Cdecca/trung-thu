<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Loves</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: radial-gradient(ellipse at center, #000011 0%, #000000 100%);
      font-family: 'Times New Roman', Times, serif;
      user-select: none;
      perspective: 1000px;
      cursor: pointer;
    }

    #galaxy, #rotatingContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
    }

    #rotatingContainer {
      z-index: 2;
      top: 50%;
      left: 50%;
      transform-style: preserve-3d;
      transform-origin: center center;
      transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg);
    }

    .text-particle, .image-particle {
      position: absolute;
      will-change: transform, opacity;
      user-select: none;
      pointer-events: none;
    }

    .text-particle {
      white-space: nowrap;
      text-shadow: 0 0 12px rgba(255,255,255,0.8);
      color: #ff7487;
    }

    .image-particle {
      max-width: 50px;
      max-height: 50px;
      border-radius: 5px;
      filter: drop-shadow(0 0 4px #fff);

      #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #000000; /* M√†u n·ªÅn ƒëen */
      z-index: 9999; /* ƒê·∫£m b·∫£o n√≥ n·∫±m tr√™n c√πng */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: opacity 1s ease-out; /* Hi·ªáu ·ª©ng m·ªù d·∫ßn khi ho√†n t·∫•t */
      color: #ffffff; /* M√†u ch·ªØ tr·∫Øng */
      font-size: 1.2em;
    }

    .loader {
      border: 6px solid #f3f3f3; /* M√†u x√°m nh·∫°t */
      border-top: 6px solid #ff7487; /* M√†u h·ªìng n·ªïi b·∫≠t */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 2s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    }
  </style>
</head>
<body>

  <div id="galaxy"></div>
  <div id="rotatingContainer"></div>
  <div id="loadingScreen">
    <div class="loader"></div>
    <p>ƒêang t·∫£i...</p>
  </div>
  <div id="galaxy"></div>
  <div id="rotatingContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    const rotatingContainer = document.getElementById('rotatingContainer');
    const galaxy = document.getElementById('galaxy');

    const messages = ["Em √†", "Trung thu vui v·∫ª nha em y√™u üíñ", "Anh y√™u em", "M√£i y√™u", "M·ªói ng√†y c√≥ em ƒë·ªÅu l√† nh·ªØng ng√†y tuy·ªát v·ªùi", "Kho·∫£nh kh·∫Øc ƒë·∫πp nh·∫•t l√† kho·∫£nh kh·∫Øc c√≥ e b√™n c·∫°nh", "T√¨nh y√™u c·ªßa ch√∫ng ta s·∫Ω lu√¥n l√† t√¨nh y√™u tuy·ªát v·ªùi nh·∫•t, duy nh·∫•t v√† m√£i m√£i", "Wishing us a long life to share the graceful moonlight", "NƒÉm trung thu nay l·∫°i bu·ªìn n·ªØa r·ªìi", "∆∞·ªõc r·∫±ng nƒÉm sau s·∫Ω ƒë∆∞·ª£c ƒë√≥n trung thu c√πng em, cung nh∆∞ m·ªçi ng√†y l·ªÖ kh√°c", "Mong r·∫±ng em s·∫Ω ch·ªù anh", "Anh mu·ªën th∆∞∆°ng em th·∫≠t nhi·ªÅu", "Xin l·ªói em:(","L·∫°i l√†m em bu·ªìn n·ªØa r·ªìi",];
    const imageURLs = ["1.jpg", "2.jpg", "3.jpg", "4.jpg"];
    const icons = ["‚ù§Ô∏è", "‚ù§", "üíó"];
    const maxParticles = 120;
    const activeParticles = new Set();

    function createParticle(type = 'text') {
      if (activeParticles.size >= maxParticles) return;

      const el = type === 'text' ? document.createElement('div') : document.createElement('img');
      if (type === 'text') {
        const isIcon = Math.random() < 0.3;
        el.className = 'text-particle';
        el.textContent = isIcon ? icons[Math.floor(Math.random() * icons.length)] : messages[Math.floor(Math.random() * messages.length)];
        el.style.fontSize = (isIcon ? 20 : 18) + Math.random() * 10 + 'px';
      } else {
        el.className = 'image-particle';
        el.src = imageURLs[Math.floor(Math.random() * imageURLs.length)];
      }
      el.style.opacity = 0;
      rotatingContainer.appendChild(el);

      const w = el.offsetWidth || 40;
      el.style.left = Math.random() * (window.innerWidth - w) + 'px';

      const z = -Math.random() * 300;
      const startY = -50;
      const endY = window.innerHeight + 50;
      const duration = 7000 + Math.random() * 4000;
      const t0 = performance.now();

      function animate(t) {
        const p = (t - t0) / duration;
        if (p >= 1) {
          el.remove();
          activeParticles.delete(el);
        } else {
          const y = startY + p * (endY - startY);
          const op = p < 0.1 ? p * 10 : (p > 0.9 ? (1 - p) * 10 : 1);
          el.style.opacity = op;
          el.style.transform = `translate3d(0, ${y}px, ${z}px)`;
          requestAnimationFrame(animate);
        }
      }

      activeParticles.add(el);
      requestAnimationFrame(animate);
    }

    function loopParticles() {
      let last = 0;
      function tick(t) {
        if (t - last > 300) {
          createParticle('text');
          if (Math.random() < 0.5) createParticle('image');
          last = t;
        }
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function startStars() {
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 150;

      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x000000, 0);
      galaxy.appendChild(renderer.domElement);

      const starsCount = 500;
      const positions = new Float32Array(starsCount * 3);
      for (let i = 0; i < starsCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 400;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 400;
        positions[i * 3 + 2] = (Math.random() - 0.5) * 400;
      }

      const geometry = new THREE.BufferGeometry();
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

      const starTexture = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/disc.png');
      const material = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.5,
        map: starTexture,
        transparent: true,
        alphaTest: 0.2,
        depthWrite: false
      });

      const stars = new THREE.Points(geometry, material);
      scene.add(stars);

      function animate() {
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    function initRotation() {
      function updateRotation(x, y) {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        const rotY = ((x - cx) / cx) * 10;
        const rotX = (-(y - cy) / cy) * 10;
        rotatingContainer.style.transform = `translate(-50%, -50%) rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      }

      document.addEventListener('mousemove', e => updateRotation(e.clientX, e.clientY));
      document.addEventListener('touchmove', e => {
        if (e.touches.length > 0) {
          const t = e.touches[0];
          updateRotation(t.clientX, t.clientY);
        }
      }, { passive: true });
    }

    function setupMusic() {
      let started = false;
      document.body.addEventListener('click', () => {
        if (started) return;
        const audio = new Audio('./e.mp3');
        audio.loop = true;
        audio.play().catch(() => console.log("Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông."));
        started = true;
      });
    }

    function hideLoadingScreen() {
      const loadingScreen = document.getElementById('loadingScreen');
      if (loadingScreen) {
        // ƒê·∫∑t ƒë·ªô m·ªù (opacity) v·ªÅ 0 ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng m·ªù d·∫ßn
        loadingScreen.style.opacity = '0';
        
        // Lo·∫°i b·ªè ph·∫ßn t·ª≠ kh·ªèi DOM sau khi hi·ªáu ·ª©ng transition k·∫øt th√∫c (1000ms = 1s)
        setTimeout(() => {
          loadingScreen.remove();
        }, 1000); 
      }
    }

    window.addEventListener('load', () => {
      // 'load' event ƒë·∫£m b·∫£o m·ªçi t√†i nguy√™n (images, scripts, three.js) ƒë√£ t·∫£i xong
      startStars();
      loopParticles();
      initRotation();
      setupMusic();
      
      // ·∫®n m√†n h√¨nh loading cu·ªëi c√πng
      hideLoadingScreen();
    });

    window.addEventListener('DOMContentLoaded', () => {
      startStars();
      loopParticles();
      initRotation();
      setupMusic();
    });
  </script>
</body>
</html>
